{% extends 'base.html' %}

{% block  content %}
<script> 
    function onBtnUpdate(){
        console.log('Update Button called');
        $.ajax({
            url : "update_atp_match/", // the endpoint
            type : "GET", // http method
            success : function(json) {
                console.log("success"); // another sanity check
            },

            // handle a non-successful response
            error : function(xhr,errmsg,err) {                
                console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
            }
        });
    }

    function onBtnDelete() {
        if(confirm('Are you sure to delete all data?')){
            $.ajax({
                url : "remove_atp_match/", // the endpoint
                type : "GET", // http method
                success : function(json) {
                    console.log("success"); // another sanity check
                },

                // handle a non-successful response
                error : function(xhr,errmsg,err) {                
                    console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
                }
            });
        }
    }

    function onBtnUpdatePerform() {
        $.ajax({
            url : "update_atp_perform/", 
            type : "GET", 
            success : function(json) {
                console.log("success"); // another sanity check
                alert('success');
            },
            // handle a non-successful response
            error : function(xhr,errmsg,err) {                
                console.log(xhr.status + ": " + xhr.responseText); 
                alert('failed');
            }
        });
    }

    $(document).ready(function() {
         $('.table-row').click(function() {
            console.log($(this).attr('data-id'));
            /* $('#dialog').dialog({
                autoOpen : false,
                show : {
                    effect : "blind",
                    duration : 1000
                },
                hide : {
                    effect : 'explode',
                    duration: 1000,
                }
            }); /**/
            console.log($(this).attr('data-waces'));
            $('#winner').text($(this).attr('data-winner'));
            $('#wdfault').text($(this).attr('data-wdfault'));
            $('#waces').text($(this).attr('data-waces'));
            $('#wser1').text($(this).attr('data-wser1'));
            $('#wser2').text($(this).attr('data-wser2'));
            $('#wser').text($(this).attr('data-wser'));
            $('#wrec').text($(this).attr('data-wrec'));
            $('#wtotal').text($(this).attr('data-wtotal'));
            
            $('#loser').text($(this).attr('data-loser'));
            $('#ldfault').text($(this).attr('data-ldfault'));
            $('#laces').text($(this).attr('data-laces'));
            $('#lser1').text($(this).attr('data-lser1'));
            $('#lser2').text($(this).attr('data-lser2'));
            $('#lser').text($(this).attr('data-lser'));
            $('#lrec').text($(this).attr('data-lrec'));
            $('#ltotal').text($(this).attr('data-ltotal'));
            $("#detailModal").modal();
        });
        
    })
    
</script>
<!-- Modal -->
<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="detailModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detailModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body container" style="display:inline-block;">
        <table class="container">
            <thead> 
                <th>Cateogories</th>
                <th>Winner</th>
                <th>Loser</th>
            </thead>
            <tbody>
                <tr><td> Name </td> <td id="winner"> </td> <td id="loser"> </td> </tr>
                <tr><td> Double Fault </td> <td id="wdfault"> </td> <td id="ldfault"> </td> </tr>
                <tr><td> Aces </td> <td id="waces"> </td> <td id="laces"> </td> </tr>
                <tr><td> 1st Serve won </td> <td id="wser1"> </td> <td id="lser1"> </td> </tr>
                <tr><td> 2nd Serve won </td> <td id="wser2"> </td> <td id="lser2"> </td> </tr>
                <tr><td> Total Serve won </td> <td id="wser"> </td> <td id="lser"> </td> </tr>
                <tr><td> Receive won </td> <td id="wrec"> </td> <td id="lrec"> </td> </tr>
                <tr><td> Total  </td> <td id="wtotal"> </td> <td id="ltotal"> </td> </tr>
            </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<div class="container"> <p> <a href='{% url 'home' %}'> Home </a> > <a href='{% url 'match_list' %}'>Match list</a> </p> </div>
<h1> Matches list </h1>
<button class="btn btn-success" onclick = "onBtnUpdate()"> Update Match </button>
<button class="btn btn-danger" onclick = "onBtnDelete()"> Delete </button>
<button class="btn btn-primary" onclick = "onBtnUpdatePerform()"> Update Performance </button>
<table class="table table-striped table-sm table-border table-hover table-responsive">
<thead>
    <th> No </th>
    <th> Date </th>
    <th> Round </th>
    <th> Tournament Name </th>
    <th> Location </th>
    <th> Status </th>
    <th> Winner </th>
    <th> Loser </th>
    <th> Wsets </th>
    <th> Lsets </th>
    <th> W1 </th>
    <th> L1 </th>
    <th> W2 </th>
    <th> L2 </th>
    <th> W3 </th>
    <th> L3 </th>
    <th> W4 </th>
    <th> L4 </th>
    <th> W5 </th>
    <th> L5 </th>
    <th> Total sets </th>
    <th> Total games </th>
    <th> Bestof </th>
    <th> Comment </th>
    <th> Home </th>
    <th> Away </th>

    <th> Waces </th>
    <th> Laces </th>
    <th> Wser1 </th>
    <th> Lser1 </th>
    <th> Wser2 </th>
    <th> Lser2 </th>
    <th> Wser </th>
    <th> Lser </th>
    <th> Wrec </th>
    <th> Lrec </th>
    <th> Wtotal </th>
    <th> Ltotal </th>
    
    <th> B365w </th>
    <th> B365l </th>
    <th> PSW </th>
    <th> PSL </th>
    <th> Maxw </th>
    <th> Maxl </th>
    <th> Ubw </th>
    <th> Ubl </th>
    <th> Bcw </th>
    <th> Bcl </th>
    <th> Avgw </th>
    <th> Avgl </th>

</thead>
<tbody >
    {% for match in matches %}
        {% if match.status == 'fin' %}
        <tr class = 'table-success table-row' 
            data-id = "{{ forloop.counter }}"
            data-winner = "{{ match.winner }}"
            data-wdfault = "{{ match.wdfault }}"
            data-waces = "{{ match.waces}}"
            data-wsera = "{{ match.wsera}}"
            data-wserb = "{{ match.wserb}}"
            data-wser = "{{ match.wser}}"
            data-wrec = "{{ match.wrec}}"
            data-wtotal = "{{ match.wtotal}}"
        
            data-loser = "{{ match.loser}}"
            data-ldfault = "{{ match.ldfault }}"
            data-laces = "{{ match.laces}}"
            data-lsera = "{{ match.lsera}}"
            data-lserb = "{{ match.lserb}}"
            data-lser = "{{ match.lser}}"
            data-lrec = "{{ match.lrec}}"
            data-ltotal = "{{ match.ltotal}}"
        >
            <td> {{ forloop.counter }} </td> 
            <td > {{ match.date | date:'m-d ' }} </td>
            <td> {{ match.round }} </td>
            <td> {{ match.tournament}} </td>
            <td> {{ match.location }} </td>
            <td> {{ match.status }} </td>
            <td style="color:red;"> {{ match.winner }} </td>
            <td style="color:grey;"> {{ match.loser }} </td>
            <td> <h3> {{ match.wsets }} </h3> </td>
            <td> <h3> {{ match.lsets }} </h3> </td>
            <td> {{ match.w1 }} </td>
            <td> {{ match.l1 }} </td>
            <td> {{ match.w2 }} </td>
            <td> {{ match.l2 }} </td>
            <td> {{ match.w3 }} </td>
            <td> {{ match.l3 }} </td>
            <td> {{ match.w4 }} </td>
            <td> {{ match.l4 }} </td>
            <td> {{ match.w5 }} </td>
            <td> {{ match.l5 }} </td>
            <td> {{ match.totalsets }} </td>
            <td> {{ match.totalgames }} </td>
            <td> {{ match.bestof }} </td>
            <td> {{ match.comment }} </td>
            {% if match.home == match.winner %}
                <td style="color:red;"> {{ match.home }} </td>
                <td style="color:grey;"> {{ match.away }} </td>
            {% else %}
                <td style="color:grey;"> {{ match.home }} </td>
                <td style="color:red;"> {{ match.away }} </td>
            {% endif %}
            <td> {{ match.waces }} </td>
            <td> {{ match.laces }} </td>
            <td> {{ match.wser1 }} </td>
            <td> {{ match.lser1 }} </td>
            <td> {{ match.wser2 }} </td>
            <td> {{ match.lser2 }} </td>
            <td> {{ match.wser }} </td>
            <td> {{ match.lser }} </td>
            <td> {{ match.wrec }} </td>
            <td> {{ match.lrec }} </td>
            <td> {{ match.wtotal }} </td>
            <td> {{ match.ltotal }} </td>
        </tr>
        
        {% elif match.status == 'sched' %}
        <tr class = 'table-warning'>  
            <td> {{ forloop.counter }} </td> 
            <td> {{ match.date|date:'m-d' }} </td>
            <td> {{ match.round }} </td>
            <td> {{ match.location }} </td>
            <td> {{ match.tournament_name }} </td>
            <td> {{ match.status }} </td>
            <td> - </td>
            <td> - </td>
            <td> <h3> - </h3> </td>
            <td> <h3> - </h3> </td>
            <td> - </td>
            <td> - </td>
            <td> - </td>
            <td> - </td>
            <td> - </td>
            <td> - </td>
            <td> - </td>
            <td> - </td>
            <td> - </td>
            <td> - </td>
        </tr>

        {% elif match.status == 'live' %}
        <tr class='table-danger'>
            <td> {{ forloop.counter }} </td> 
            <td> {{ match.date|date:'m-d' }} </td>
            <td> {{ match.round }} </td>
            <td> {{ match.location }} </td>
            <td> {{ match.tournament_name }} </td>
            <td> {{ match.status }} </td>
            <td> {{ match.winner }} </td>
            <td> {{ match.loser }} </td>
            <td> <h3> {{ match.wsets }} </h3> </td>
            <td> <h3> {{ match.lsets }} </h3> </td>
            <td> {{ match.w1 }} </td>
            <td> {{ match.l1 }} </td>
            <td> {{ match.w2 }} </td>
            <td> {{ match.l2 }} </td>
            <td> {{ match.w3 }} </td>
            <td> {{ match.l3 }} </td>
            <td> {{ match.w4 }} </td>
            <td> {{ match.l4 }} </td>
            <td> {{ match.w5 }} </td>
            <td> {{ match.l5 }} </td>
        </tr>
        {% endif %}
        
    {% endfor %}
</tbody>
</table>


{% endblock  %}